/**
 * ====================================
 * Index Routes - Ù…Ø±Ú©Ø²ÛŒ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù…Ø³ÛŒØ±Ù‡Ø§
 * ====================================
 */

const express = require('express');
const router = express.Router();

// ======================================================
// Import Existing Routes
// ======================================================
const authRoutes = require('./authRoutes');
const userRoutes = require('./userRoutes');
const productRoutes = require('./productRoutes');
const categoryRoutes = require('./categoryRoutes');
const cartRoutes = require('./cartRoutes');
const orderRoutes = require('./orderRoutes');
const paymentRoutes = require('./paymentRoutes');
const productReviewRoutes = require('./productReviewRoutes');
const adminReviewRoutes = require('./adminReviewRoutes');
const adminRoutes = require('./adminRoutes');
const adminProductRoutes = require('./adminProductRoutes');

// ======================================================
// ğŸ†• Import New Routes
// ======================================================
const couponRoutes = require('./couponRoutes');
const notificationRoutes = require('./notificationRoutes');
const wishlistRoutes = require('./wishlistRoutes');
const ticketRoutes = require('./ticketRoutes');
const searchRoutes = require('./searchRoutes');

// ======================================================
// Mount Existing Routes
// ======================================================

// Authentication Routes
router.use('/auth', authRoutes);

// User Routes
router.use('/users', userRoutes);

// Product Routes
router.use('/products', productRoutes);

// Category Routes
router.use('/categories', categoryRoutes);

// Cart Routes
router.use('/cart', cartRoutes);

// Order Routes
router.use('/orders', orderRoutes);

// Payment Routes
router.use('/payments', paymentRoutes);

// Review Routes
router.use('/reviews', productReviewRoutes);

// Admin Review Routes
router.use('/admin/reviews', adminReviewRoutes);

// Admin Routes
router.use('/admin', adminRoutes);
router.use('/v1/admin/products', adminProductRoutes);

// ======================================================
// ğŸ†• Mount New Routes
// ======================================================

// Coupon Routes
router.use('/coupons', couponRoutes);

// Notification Routes
router.use('/notifications', notificationRoutes);

// Wishlist Routes
router.use('/wishlist', wishlistRoutes);
// Tickets Routes
router.use('/tickets', ticketRoutes);

// Search Routes
router.use('/search', searchRoutes);

// ======================================================
// Health Check Endpoint
// ======================================================
router.get('/health', (req, res) => {
    res.status(200).json({
        success: true,
        message: 'API Ø³Ø§Ù„Ù… Ø§Ø³Øª',
        status: 'UP',
        version: '1.1.0', // ğŸ†• Version updated
        timestamp: new Date().toISOString(),
        uptime: process.uptime(),
        memory: {
            total: Math.round(process.memoryUsage().heapTotal / 1024 / 1024) + ' MB',
            used: Math.round(process.memoryUsage().heapUsed / 1024 / 1024) + ' MB'
        },
        routes: {
            auth: '/api/auth',
            users: '/api/users',
            products: '/api/products',
            categories: '/api/categories',
            cart: '/api/cart',
            orders: '/api/orders',
            payments: '/api/payments',
            reviews: '/api/reviews',
            admin: '/api/admin',
            adminProducts: '/api/v1/admin/products',
            // ğŸ†• New routes
            coupons: '/api/coupons',
            notifications: '/api/notifications',
            wishlist: '/api/wishlist',
            search: '/api/search'
        }
    });
});

// ======================================================
// API Info Endpoint
// ======================================================
router.get('/', (req, res) => {
    res.status(200).json({
        success: true,
        message: 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ API ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ÙˆÛŒÙ„Ùâ€ŒÙˆÛŒØªØ§',
        version: '1.1.0',
        documentation: '/api/docs',
        health: '/api/health',
        endpoints: {
            authentication: {
                register: 'POST /api/auth/register',
                login: 'POST /api/auth/login',
                logout: 'POST /api/auth/logout',
                refreshToken: 'POST /api/auth/refresh-token',
                forgotPassword: 'POST /api/auth/forgot-password',
                resetPassword: 'POST /api/auth/reset-password',
                verifyEmail: 'GET /api/auth/verify-email/:token'
            },
            users: {
                profile: 'GET /api/users/profile',
                updateProfile: 'PUT /api/users/profile',
                changePassword: 'PUT /api/users/change-password',
                addresses: 'GET /api/users/addresses',
                orders: 'GET /api/users/orders',
                deleteAccount: 'DELETE /api/users/account'
            },
            products: {
                list: 'GET /api/products',
                single: 'GET /api/products/:id',
                bySlug: 'GET /api/products/slug/:slug',
                featured: 'GET /api/products/featured',
                create: 'POST /api/products (Admin)',
                update: 'PUT /api/products/:id (Admin)',
                delete: 'DELETE /api/products/:id (Admin)'
            },
            categories: {
                list: 'GET /api/categories',
                tree: 'GET /api/categories/tree',
                single: 'GET /api/categories/:id',
                bySlug: 'GET /api/categories/slug/:slug',
                featured: 'GET /api/categories/featured'
            },
            cart: {
                get: 'GET /api/cart',
                add: 'POST /api/cart/add',
                update: 'PUT /api/cart/update',
                remove: 'DELETE /api/cart/remove/:productId',
                clear: 'DELETE /api/cart/clear'
            },
            orders: {
                list: 'GET /api/orders',
                single: 'GET /api/orders/:id',
                create: 'POST /api/orders',
                cancel: 'PUT /api/orders/:id/cancel',
                track: 'GET /api/orders/:id/track'
            },
            payments: {
                create: 'POST /api/payments/create',
                verify: 'GET /api/payments/verify',
                myPayments: 'GET /api/payments/my-payments'
            },
            reviews: {
                create: 'POST /api/reviews',
                update: 'PUT /api/reviews/:id',
                delete: 'DELETE /api/reviews/:id',
                myReviews: 'GET /api/reviews/my-reviews'
            },
            // ğŸ†• New Endpoints
            coupons: {
                available: 'GET /api/coupons/available',
                validate: 'POST /api/coupons/validate',
                apply: 'POST /api/coupons/apply',
                remove: 'DELETE /api/coupons/remove',
                list: 'GET /api/coupons (Admin)',
                create: 'POST /api/coupons (Admin)',
                update: 'PUT /api/coupons/:id (Admin)',
                delete: 'DELETE /api/coupons/:id (Admin)',
                toggle: 'PATCH /api/coupons/:id/toggle (Admin)',
                stats: 'GET /api/coupons/:id/stats (Admin)'
            },
            notifications: {
                list: 'GET /api/notifications',
                unreadCount: 'GET /api/notifications/unread-count',
                single: 'GET /api/notifications/:id',
                markAsRead: 'PATCH /api/notifications/:id/read',
                markAllAsRead: 'PATCH /api/notifications/read-all',
                delete: 'DELETE /api/notifications/:id',
                deleteAll: 'DELETE /api/notifications/all',
                deleteRead: 'DELETE /api/notifications/read',
                create: 'POST /api/notifications (Admin)',
                stats: 'GET /api/notifications/admin/stats (Admin)'
            },
            wishlist: {
                get: 'GET /api/wishlist',
                add: 'POST /api/wishlist',
                remove: 'DELETE /api/wishlist/:productId',
                toggle: 'POST /api/wishlist/toggle/:productId',
                check: 'GET /api/wishlist/check/:productId',
                updateNote: 'PATCH /api/wishlist/:productId/note',
                updatePriority: 'PATCH /api/wishlist/:productId/priority',
                clear: 'DELETE /api/wishlist/clear',
                moveToCart: 'POST /api/wishlist/:productId/move-to-cart'
            },
            search: {
                products: 'GET /api/search',
                filters: 'GET /api/search/filters',
                suggestions: 'GET /api/search/suggestions'
            },
            admin: {
                dashboard: 'GET /api/admin/dashboard',
                users: 'GET /api/admin/users',
                orders: 'GET /api/admin/orders',
                stats: 'GET /api/admin/orders/stats',
                reviews: 'GET /api/admin/reviews'
            }
        },
        features: {
            authentication: 'âœ… JWT Authentication & Authorization',
            products: 'âœ… Product Management with Images',
            categories: 'âœ… Hierarchical Categories (Tree Structure)',
            cart: 'âœ… Shopping Cart with Session',
            orders: 'âœ… Order Management & Tracking',
            payments: 'âœ… Online Payment Gateway (ZarinPal)',
            reviews: 'âœ… Product Reviews & Ratings',
            coupons: 'âœ… Discount Coupons & Promotions',
            notifications: 'âœ… Real-time Notifications',
            wishlist: 'âœ… User Wishlist',
            search: 'âœ… Advanced Search & Filters',
            security: 'âœ… Rate Limiting, Helmet, Sanitization',
            cache: 'âœ… Redis Caching',
            logging: 'âœ… Morgan & Custom Logger'
        },
        support: {
            email: 'support@wilfvita.com',
            documentation: 'https://docs.wilfvita.com',
            github: 'https://github.com/yourusername/wilfvita-backend'
        }
    });
});

// ======================================================
// ğŸ†• API Statistics Endpoint
// ======================================================
router.get('/stats', (req, res) => {
    const routes = router.stack
        .filter(r => r.route)
        .map(r => ({
            path: r.route.path,
            methods: Object.keys(r.route.methods)
        }));

    res.status(200).json({
        success: true,
        totalRoutes: routes.length,
        totalEndpoints: router.stack.length,
        availableRoutes: routes
    });
});

// ======================================================
// 404 Handler for undefined API routes
// ======================================================
router.use('*', (req, res) => {
    res.status(404).json({
        success: false,
        message: 'Ù…Ø³ÛŒØ± Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯',
        path: req.originalUrl,
        method: req.method,
        suggestion: 'Ù„Ø·ÙØ§Ù‹ Ù…Ø³ØªÙ†Ø¯Ø§Øª API Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯',
        documentation: '/api',
        timestamp: new Date().toISOString()
    });
});

module.exports = router;

